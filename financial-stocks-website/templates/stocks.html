<!DOCTYPE html>
<html>
<head>
    <title>Financial Stocks Website - Stocks</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Include the moment.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <!-- Include the Chart.js library with the moment adapter -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
    <style>
        body {
            margin: 0; /* Reset default margin */
            font-family: Arial, sans-serif; /* Set a common font for better readability */
            background-color: #f0f0f0; /* Add a light background color */
        }
        header {
            background-color: #222;
            color: #fff;
            text-align: center;
            padding: 2em;
        }
        header ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: flex-end;
        }
        header ul li {
            margin-right: 70px; /* Reduced margin for better spacing */
        }
        header ul li a {
            color: #fff;
            text-decoration: none;
        }
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            z-index: 1;
        }
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .content {
            max-width: 800px;
            margin: 0 auto; /* Center-align content and add margin */
            padding: 20px; /* Add padding for better spacing */
            background-color: #fff; /* White background for content */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Add a subtle box shadow */
        }
        h2 {
            margin-top: 0; /* Reset margin for headings */
            color: #333; /* Darker color for headings */
        }
        p {
            margin-bottom: 16px; /* Add margin at the bottom of paragraphs */
            line-height: 1.6; /* Increase line height for better readability */
            color: #555; /* Slightly darker color for text */
        }
        ol {
            margin-left: 20px; /* Indent the ordered list */
        }
        strong {
            font-weight: bold; /* Use font-weight property for boldness */
            color: #333; /* Darker color for bold text */
        }
    </style>
</head>
<body>
    <header>
        <h1>STOCK.AI</h1>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li class="dropdown">
                    <a href="javascript:void(0)">Stocks</a>
                    <div class="dropdown-content">
                        <a href="/stocks/sp500">S&P500</a>
                        <a href="/stocks/ibex35">IBEX35</a>
                        <a href="/stocks/nasdq">NASDQ</a>
                    </div>
                </li>
            </ul>
        </nav>
    </header>
    <section class="content">
        <h2>Stock Data for {{ table_name }}</h2>
        <div class="chart-controls">
            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" name="startDate">
            <label for="endDate">End Date:</label>
            <input type="date" id="endDate" name="endDate">
            <button id="filterButton">Filter</button>
        </div>
        <div class="chart-container">
            <canvas id="stockChart"></canvas>
        </div>
    </section>
    
    <script>
        var stockDates = {{ stock_dates|tojson|safe }};
        var stockPrices = {{ stock_prices|tojson|safe }};
        var stockVolumes = {{ stock_volumes|tojson|safe }};
    
        // Initialize the chart with initial data
        var ctx = document.getElementById('stockChart').getContext('2d');
        var stockChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: stockDates,
                datasets: [
                    {
                        label: 'Stock Price',
                        data: stockPrices,
                        borderColor: 'blue',
                        backgroundColor: 'rgba(0, 0, 255, 0.1)',
                        borderWidth: 1,
                        yAxisID: 'price-y-axis' // Associate with the price y-axis
                    },
                    {
                        label: 'Volume',
                        data: stockVolumes,
                        borderColor: 'green',
                        backgroundColor: 'rgba(0, 255, 0, 0.1)',
                        borderWidth: 1,
                        yAxisID: 'volume-y-axis' // Associate with the volume y-axis
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'month'
                        }
                    },
                    priceY: {
                        beginAtZero: false,
                        position: 'left', // Position on the left side
                        title: {
                            display: true,
                            text: 'Stock Price'
                        }
                    },
                    volumeY: {
                        beginAtZero: true,
                        position: 'right', // Position on the right side
                        title: {
                            display: true,
                            text: 'Volume'
                        }
                    }
                }
            }
        });
    
        // Handle filter button click
        document.getElementById('filterButton').addEventListener('click', function () {
            var startDate = document.getElementById('startDate').value;
            var endDate = document.getElementById('endDate').value;
    
            // Filter data based on selected date range
            var filteredDates = [];
            var filteredPrices = [];
            var filteredVolumes = [];
            for (var i = 0; i < stockDates.length; i++) {
                if (stockDates[i] >= startDate && stockDates[i] <= endDate) {
                    filteredDates.push(stockDates[i]);
                    filteredPrices.push(stockPrices[i]);
                    filteredVolumes.push(stockVolumes[i]);
                }
            }
    
            // Update the chart with filtered data
            stockChart.data.labels = filteredDates;
            stockChart.data.datasets[0].data = filteredPrices;
            stockChart.data.datasets[1].data = filteredVolumes;
            stockChart.update();
        });
    </script>
    
</body>
</html>
